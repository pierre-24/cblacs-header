
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="scaLAPACe -- provide a set of headers and wrappers for scaLAPACK in C">
      
      
      
        <link rel="canonical" href="https://pierrebeaujean.github.io/scalapacke/dev/tutorial/">
      
      
        <link rel="prev" href="../quickstart/">
      
      
        <link rel="next" href="../../contrib/CONTRIBUTING/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.33">
    
    
      
        <title>Tutorial - Documentation of scaLAPACKe</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#a-gentle-introduction-to-scalapacke" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Documentation of scaLAPACKe" class="md-header__button md-logo" aria-label="Documentation of scaLAPACKe" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation of scaLAPACKe
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/pierre-24/scalapacke" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pierre-24/scalapacke
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Documentation of scaLAPACKe" class="md-nav__button md-logo" aria-label="Documentation of scaLAPACKe" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Documentation of scaLAPACKe
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pierre-24/scalapacke" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pierre-24/scalapacke
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    For developers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            For developers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-linear-algebra-ecosystem-of-lapack-and-friends" class="md-nav__link">
    <span class="md-ellipsis">
      The linear algebra ecosystem of LAPACK and friends
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The linear algebra ecosystem of LAPACK and friends">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-historical-perspective" class="md-nav__link">
    <span class="md-ellipsis">
      A "historical" perspective
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#naming-conventions-in-blaslapack" class="md-nav__link">
    <span class="md-ellipsis">
      Naming conventions in BLAS/LAPACK
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-about-scalapack" class="md-nav__link">
    <span class="md-ellipsis">
      What about scaLAPACK?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      C interfaces?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-code" class="md-nav__link">
    <span class="md-ellipsis">
      Let's code!
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Let's code!">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-initialize-the-grid" class="md-nav__link">
    <span class="md-ellipsis">
      1. Initialize the grid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-distribute-data-on-the-grid" class="md-nav__link">
    <span class="md-ellipsis">
      2. Distribute data on the grid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Distribute data on the grid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filling-the-array-locally" class="md-nav__link">
    <span class="md-ellipsis">
      Filling the array locally
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broadcasting-the-array" class="md-nav__link">
    <span class="md-ellipsis">
      Broadcasting the array
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-call-the-function" class="md-nav__link">
    <span class="md-ellipsis">
      3. Call the function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-release" class="md-nav__link">
    <span class="md-ellipsis">
      4. Release!
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compilation-and-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Compilation and execution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes-on-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Notes on Performance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusions" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusions
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    For contributors
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            For contributors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contrib/CONTRIBUTING/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contrib/notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Important notes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-linear-algebra-ecosystem-of-lapack-and-friends" class="md-nav__link">
    <span class="md-ellipsis">
      The linear algebra ecosystem of LAPACK and friends
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The linear algebra ecosystem of LAPACK and friends">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-historical-perspective" class="md-nav__link">
    <span class="md-ellipsis">
      A "historical" perspective
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#naming-conventions-in-blaslapack" class="md-nav__link">
    <span class="md-ellipsis">
      Naming conventions in BLAS/LAPACK
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-about-scalapack" class="md-nav__link">
    <span class="md-ellipsis">
      What about scaLAPACK?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      C interfaces?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-code" class="md-nav__link">
    <span class="md-ellipsis">
      Let's code!
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Let's code!">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-initialize-the-grid" class="md-nav__link">
    <span class="md-ellipsis">
      1. Initialize the grid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-distribute-data-on-the-grid" class="md-nav__link">
    <span class="md-ellipsis">
      2. Distribute data on the grid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Distribute data on the grid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filling-the-array-locally" class="md-nav__link">
    <span class="md-ellipsis">
      Filling the array locally
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broadcasting-the-array" class="md-nav__link">
    <span class="md-ellipsis">
      Broadcasting the array
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-call-the-function" class="md-nav__link">
    <span class="md-ellipsis">
      3. Call the function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-release" class="md-nav__link">
    <span class="md-ellipsis">
      4. Release!
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compilation-and-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Compilation and execution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes-on-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Notes on Performance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusions" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusions
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="a-gentle-introduction-to-scalapacke">A gentle introduction to (sca)LAPACK(e)<a class="headerlink" href="#a-gentle-introduction-to-scalapacke" title="Permanent link">¤</a></h1>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Information on scaLAPACK is sparse online, with most resources limited to a few blog posts or StackOverflow questions. The most comprehensive source of information is the <a href="https://netlib.org/scalapack/slug/index.html">scaLAPACK User's Guide</a>.</p>
<p>The most detailed documentation for understanding the usage of each argument is often found in the <a href="https://github.com/Reference-ScaLAPACK/scalapack">source code of the reference implementation</a>, which isn't the most user-friendly approach.</p>
<p>This document aims to guide you through the somewhat obscure world of scaLAPACK, providing helpful insights along the way.</p>
</div>
<h2 id="the-linear-algebra-ecosystem-of-lapack-and-friends">The linear algebra ecosystem of LAPACK and friends<a class="headerlink" href="#the-linear-algebra-ecosystem-of-lapack-and-friends" title="Permanent link">¤</a></h2>
<p>Before diving into some code, it is important to understand from where this scaLAPACK thing comes from, why it is so important, and how to use it in the first place.</p>
<h3 id="a-historical-perspective">A "historical" perspective<a class="headerlink" href="#a-historical-perspective" title="Permanent link">¤</a></h3>
<p>Basic linear algebra operations, such as matrix and vector manipulations, form the backbone of many scientific applications. 
However, when it comes to more complex tasks like finding eigenvalues, solving systems of equations, or matrix decompositions, the challenge increases significantly. 
Fortunately, these complex calculations often rely on a set of common low-level operations, known as <em>kernels</em>, such as matrix multiplication.</p>
<p><strong><a href="https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms">BLAS</a></strong> (Basic Linear Algebra Subprograms) is a foundational library that provides these kernels for performing operations on and between vectors and matrices. 
BLAS is categorized into three "levels," which reflect its historical development:</p>
<ol>
<li><strong>Level 1:</strong> Vector operations (e.g., dot product, norm, addition).</li>
<li><strong>Level 2:</strong> Matrix-vector operations (including matrix-vector multiplication).</li>
<li><strong>Level 3:</strong> Matrix-matrix operations.</li>
</ol>
<p>Indeed, the distinction between these levels is mainly historical: Level 1 was developed first, followed by Level 2, and so on.
It has no importance in practice.</p>
<p><strong><a href="https://en.wikipedia.org/wiki/LAPACK">LAPACK</a></strong> (Linear Algebra PACKage) builds on top of BLAS to perform the more complex operations mentioned earlier, like solving linear systems and eigenvalue problems.</p>
<p>The historical, or "reference," implementations of BLAS and LAPACK are hosted in the <a href="https://www.netlib.org/">netlib repository</a>, often referred to as <em>netlib BLAS &amp; LAPACK</em> or simply <em>the</em> BLAS and LAPACK.</p>
<p>Due to their widespread use, the APIs (i.e., the definitions of routines and their behavior) of both BLAS and LAPACK have become <em>de facto</em> standards. 
While various implementations exist, they all adhere to the same API and behavior, allowing them to be (in theory) interchanged seamlessly. 
Different implementations focus on optimizing performance or leveraging modern accelerators like GPUs. 
BLAS, being the performance-critical component of LAPACK, has more implementations, including <a href="https://www.openblas.net/">OpenBLAS</a>, <a href="https://math-atlas.sourceforge.net/">ATLAS</a>, <a href="https://github.com/flame/blis">BLIS</a>, and <a href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/onemkl.html">oneMKL</a>. 
Notably, oneMKL also includes an implementation of (sca)LAPACK.</p>
<p>As computing and supercomputing infrastructure evolved, the development of <a href="https://en.wikipedia.org/wiki/Distributed_memory">distributed memory</a> systems became crucial. 
In these systems, each processor (or subset of processors) has access to local, typically private, memory. 
Since computations can only be performed on local data, communication between processors is necessary, leading to the development of the <a href="https://en.wikipedia.org/wiki/Message_Passing_Interface">Message Passing Interface</a> (MPI). 
MPI is another standard that defines a common API for communication via messages. 
There are various MPI implementations, including <a href="https://www.open-mpi.org/">OpenMPI</a> and <a href="https://www.mpich.org/">MPICH</a>.</p>
<p>Finally, <strong><a href="https://en.wikipedia.org/wiki/ScaLAPACK">scaLAPACK</a></strong> is an implementation of a subset of LAPACK routines tailored for distributed memory systems. 
It is built on top of <a href="https://en.wikipedia.org/wiki/PBLAS"><strong>PBLAS</strong></a>, which provides distributed-memory versions of BLAS routines. 
Both scaLAPACK and PBLAS are based on MPI but use an abstraction layer called <strong>BLACS</strong>. 
Although BLACS was designed to support other message-passing libraries like <a href="https://en.wikipedia.org/wiki/Parallel_Virtual_Machine">PVM</a>, MPI is the only choice today.</p>
<p>The resulting hierarchy of these building blocks is illustrated in the following diagram:</p>
<p><img alt="" src="../../assets/diag_scalapack.png" /></p>
<p>There do not exist a lot of implementation of scaLAPACK, which are generally the <a href="https://www.netlib.org/scalapack/"><em>reference</em> implementation from netlib</a>, but slightly tuned for performances.
One can mention <a href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/onemkl.html">oneMKL</a> and <a href="https://www.amd.com/en/developer/aocl/dense.html">AOCL</a> (which also ships a BLAS and LAPACK implementation).</p>
<h3 id="naming-conventions-in-blaslapack">Naming conventions in BLAS/LAPACK<a class="headerlink" href="#naming-conventions-in-blaslapack" title="Permanent link">¤</a></h3>
<p>BLAS and LAPACK subroutines are distinctive for two key reasons:</p>
<ol>
<li>
<p><strong>Incredibly Short Names:</strong> Typically written in uppercase (a legacy from Fortran), these names often resemble spells from a classic RPG. 
   In reality, they perform complex operations that can seem magical to non-programmers.</p>
</li>
<li>
<p><strong>Structured Naming Conventions:</strong> Despite their brevity, these names follow a specific set of rules that provide meaningful information about the subroutine's function.</p>
</li>
</ol>
<p>In BLAS and LAPACK, the naming convention is <code>&lt;type&gt;&lt;mattype&gt;&lt;op&gt;</code>, where:</p>
<ul>
<li>
<p><strong><code>&lt;type&gt;</code></strong> refers to the data type the routine operates on:</p>
<ul>
<li><code>s</code>: Single precision real (<code>float</code>)</li>
<li><code>d</code>: Double precision real (<code>double</code>)</li>
<li><code>c</code>: Single precision complex (<code>float[2]</code>)</li>
<li><code>z</code>: Double precision complex (<code>double[2]</code>)</li>
</ul>
</li>
<li>
<p><strong><code>&lt;mattype&gt;</code></strong> specifies the type and storage format of the matrix (relevant only for matrix-related routines). For example:</p>
<ul>
<li><code>ge</code>: General matrix</li>
<li><code>sy</code>: Symmetric matrix</li>
<li><code>he</code>: Hermitian matrix</li>
<li><code>tr</code>: Triangular matrix</li>
<li>Other formats like <a href="https://netlib.org/lapack/lug/node124.html">band</a> (<code>gb</code>, <code>sb</code>, etc.) and <a href="https://netlib.org/lapack/lug/node123.html">packed</a> storage (<code>sp</code>, <code>tp</code>, etc.) are also used for optimized routines.</li>
</ul>
<p>Note: Not all matrix types are available for every operation.</p>
</li>
<li>
<p><strong><code>&lt;op&gt;</code></strong> indicates the operation the routine performs. For example:</p>
<ul>
<li><code>mv</code>: Matrix-vector multiplication</li>
<li><code>mm</code>: Matrix-matrix multiplication</li>
<li><code>ev</code>: Eigenvalue computation</li>
<li><code>svd</code>: Singular value decomposition</li>
</ul>
<p>Typically, BLAS handles basic matrix and vector operations, while LAPACK offers routines for more complex tasks like solving linear systems, eigenvalue problems, and singular value decomposition.</p>
</li>
</ul>
<p>For reference, see <a href="https://netlib.org/lapack/lug/node145.html">this document</a> for a list of BLAS routines. 
A list of LAPACK functions is also availble <a href="https://www.maths.tcd.ie/~domijank/lapack.pdf">here</a>.
Finally, an extensive list can be found <a href="https://icl.utk.edu/~mgates3/docs/lapack.html">here</a>, also providing information about the implementation in other libraries as well.</p>
<p>Several unspoken rules apply to the arguments in BLAS and LAPACK routines.</p>
<p>In general,</p>
<ul>
<li><code>A</code>, <code>B</code>, <code>C</code>, etc., typically refer to matrices, while <code>W</code>, <code>X</code>, etc., refer to vectors.</li>
<li><code>ALPHA</code>, <code>BETA</code>, etc., represent scalar values.</li>
<li><code>M</code>, <code>N</code>, and <code>K</code> are used to denote the dimensions of vectors or matrices.</li>
<li><code>LDA</code>, <code>LDB</code>, etc., refer to the leading dimensions (the length of the first dimension) of matrices <code>A</code>, <code>B</code>, etc., which generally correspond to the number of rows.</li>
<li>Common arguments like <code>TRANS</code>, <code>UPLO</code>, <code>DIAG</code>, and <code>SIDE</code> are used consistently across routines to indicate matrix properties (e.g., whether to transpose, how the matrix is stored, etc.).</li>
</ul>
<p>In LAPACK,</p>
<ul>
<li>In order to avoid allocating memory for the output, it is not uncommon that the memory space of an input array which shares the dimension of the output is actually also the output.</li>
<li><code>WORK</code> is an auxiliary workspace array (single or double precision) that the user must allocate, with its size specified by <code>LWORK</code>. Similarly, <code>IWORK</code> and <code>LIWORK</code> refer to an integer workspace and its size.
  The required size of <code>LWORK</code> and <code>LIWORK</code> varies by routine and input; larger values generally lead to better performance. Setting <code>LWORK</code> to <code>-1</code> will return the optimal workspace size in <code>WORK[0]</code>, without performing the routine’s main computation.</li>
<li>An <code>INFO &lt; 0</code> return value indicates an error with the <code>i</code>-th parameter, while <code>INFO &gt; 0</code> signals a failure in the algorithm.</li>
</ul>
<p>These conventions make it easier to understand and use the routines.</p>
<h3 id="what-about-scalapack">What about scaLAPACK?<a class="headerlink" href="#what-about-scalapack" title="Permanent link">¤</a></h3>
<p>The primary routines in PBLAS and scaLAPACK are prefixed with "P", followed by the name of their non-distributed counterpart. 
While these distributed routines require additional arguments to describe the layout of vectors and matrices (as explained below), they largely retain the logic and structure of their non-distributed versions (but check the documentation to verify it is the case).</p>
<p>For example, the <a href="https://netlib.org/lapack/explore-html-3.6.1/d7/d3b/group__double_g_esolve_ga5ee879032a8365897c3ba91e3dc8d512.html"><code>(P)DGESV</code> routine</a> solve the system of linear equation <span class="arithmatex">\(A\,X = B\)</span> where <span class="arithmatex">\(A\)</span> is a <code>N</code>-by-<code>N</code> matrix and <span class="arithmatex">\(B\)</span> and <span class="arithmatex">\(X\)</span> are <code>N</code>-by-<code>NRHS</code> matrices:</p>
<p><img alt="" src="../../assets/lapack_vs_scalapack.svg" /></p>
<p>In the diagram, the common parts are highlighted in green, showing an almost 1:1 correspondence between the non-distributed and distributed versions.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Two important caveats to keep in mind:</p>
<ol>
<li>
<p><strong>Subset of LAPACK:</strong> Since scaLAPACK is only a subset of LAPACK, some routines may be unavailable.
   Additionally, in terms of matrix storage, only dense, narrow band, and tridiagonal band matrices are supported.</p>
</li>
<li>
<p><strong>Global vs. Local Arguments:</strong> to use scaLAPACK, one needs to make a distinction between global and local arguments (see below), a difference that is not reflected in the naming of the arguments.
   This is the case in the example above with <code>NHRS</code>, which in its distributed version is the number of column of the <strong>sub</strong>matrix <code>B</code> (see the <a href="https://netlib.org/scalapack/explore-html/df/df8/pdgesv_8f_source.html">source code</a>).</p>
</li>
</ol>
</div>
<p>The list of available routine is given:</p>
<ul>
<li><a href="https://netlib.org/scalapack/pblas_qref.html">here</a> for PBLAS, and</li>
<li><a href="https://netlib.org/scalapack/slug/node183.html">here</a> for scaLAPACK.</li>
</ul>
<h3 id="c-interfaces">C interfaces?<a class="headerlink" href="#c-interfaces" title="Permanent link">¤</a></h3>
<p>BLAS and (sca)LAPACK were originally written primarily in Fortran. To use them in C, several interfaces are available:</p>
<ul>
<li><strong><a href="https://www.intel.com/content/www/us/en/docs/onemkl/developer-guide-windows/2023-0/call-blas-funcs-return-complex-values-in-c-code.html">CBLAS</a>:</strong> A C interface provided by most BLAS implementations, which has become a <em>de facto</em> standard.</li>
<li><strong><a href="https://netlib.org/lapack/lapacke.html">LAPACKe</a>:</strong> A C interface offered by the few implementations of LAPACK.</li>
<li><strong>scaLAPACKe:</strong> This project, which aims to provide a similar C interface for scaLAPACK, along with its underlying layers, PBLAS and BLACS.</li>
</ul>
<p>These interfaces share a common set of conventions:</p>
<ol>
<li>The function name incorporates that of the original Fortran routine (generally lowercase).</li>
<li>The order of arguments remains unchanged, though some may be added or removed in a predictable manner, making it easy to translate a Fortran call to a C call without needing extensive documentation.</li>
<li>Arguments that are input-only and scalar are passed by value rather than by pointer, unlike in Fortran. This is predictable, and compilers typically alert you if you mistakenly pass a pointer instead of a value.</li>
<li>Unless specified, the array should store data using <a href="https://en.wikipedia.org/wiki/Row-_and_column-major_order">column-major storage</a>.</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>scaLAPACKe follows those rules.
See <a href="../quickstart/">this document for the exact suite of transformations</a>, but in short, <code>PDGESV</code> becomes <code>SCALAPACKE_pdgesv</code> and lacks the <code>INFO</code> parameter, which becomes its return value.</p>
</div>
<h2 id="lets-code">Let's code!<a class="headerlink" href="#lets-code" title="Permanent link">¤</a></h2>
<p>In the previous sections, we've explored the underlying logic of both BLAS and LAPACK, which extends naturally to scaLAPACK(e).</p>
<p>However, to fully leverage scaLAPACK(e), it's essential to embrace the <a href="https://en.wikipedia.org/wiki/Single_program,_multiple_data">SPMD</a> (Single Program, Multiple Data) paradigm. 
In this model, parallel execution is achieved by launching multiple <strong>processes</strong> using a command like <code>mpiexec</code> (details below). 
Each process is an independent and autonomous instance executing the same program, possibly on different computers, provided they can communicate with each other. 
During execution, each process is assigned:</p>
<ul>
<li>a <strong>rank</strong>, a unique identifier among all processes that allows it to identify itself and potentially modify its behavior, and</li>
<li>mechanisms to communicate with other processes.</li>
</ul>
<p>While the SPMD model avoids many issues related to shared memory in thread-based parallelism (since each process has its own private memory), it necessitates efficient data sharing between processes. 
Additionally, <a href="https://en.wikipedia.org/wiki/Deadlock_(computer_science)">deadlocks</a> are more common with this model, due to the need of explicit synchronization.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Consider the following scenario:</p>
<div class="highlight"><pre><span></span><code><span class="n">lapack_int</span><span class="w"> </span><span class="n">a_given_context</span><span class="p">;</span>
<span class="n">SCALAPACKE_do_A</span><span class="p">(</span><span class="n">a_given_context</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>

<span class="k">if</span><span class="p">(</span><span class="n">iam</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">  </span><span class="n">do_something_that_only_0_do</span><span class="p">();</span>

<span class="n">SCALAPACKE_do_B</span><span class="p">(</span><span class="n">a_given_context</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
</code></pre></div>
<p>With BLACS [and thus, PBLAS and scaLAPACK(e)], communication calls are <em>blocking</em>, meaning a function won't return until <strong>all</strong> participating processes have completed their respective tasks. </p>
<p>In this example, all processes will execute <code>SCALAPACKE_do_A</code> together. 
However, they must then wait for the rank-0 process to complete <code>do_something_that_only_0_do()</code> before proceeding to <code>SCALAPACKE_do_B</code>. 
If, for any reason, a process does not reach or execute <code>SCALAPACKE_do_B</code>, a deadlock will occur, halting the entire operation.</p>
</div>
<p>To effectively use a scaLAPACKe function, follow these four steps:</p>
<ol>
<li>Initialize a process grid, mapping the different processes to positions in a virtual grid.</li>
<li>Distribute the vectors/matrices across this grid.</li>
<li>Call the desired scaLAPACKe function.</li>
<li>Release the matrices and the grid once the computation is complete.</li>
</ol>
<p>In the rest of this tutorial, we will apply those steps to compute the eigenvalues of a symmetric matrix.
This would be achieved using <a href="https://netlib.org/lapack/explore-html/d8/d1c/group__heev_ga8995c47a7578fef733189df3490258ff.html"><code>DSYEV</code></a> in LAPACK, but all that is now to be realized using <strong>sca</strong>LAPACK<strong>e</strong>.
Thus, let's start by including the relevant headers:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;scalapacke_blacs.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;scalapacke_pblas.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;scalapacke.h&gt;</span>
</code></pre></div>
<p>... And now, let's dig into the recipe.</p>
<h3 id="1-initialize-the-grid">1. Initialize the grid<a class="headerlink" href="#1-initialize-the-grid" title="Permanent link">¤</a></h3>
<p>Following the previous discussion, the first step for a given process is to know the number of processes and its rank.
For that, we need to use a <a href="https://netlib.org/blacs/BLACS/QRef.html">BLACS</a> function.</p>
<div class="highlight"><pre><span></span><code><span class="n">lapack_int</span><span class="w"> </span><span class="n">iam</span><span class="p">,</span><span class="w"> </span><span class="n">nprocs</span><span class="p">;</span>
<span class="n">SCALAPACKE_blacs_pinfo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">iam</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nprocs</span><span class="p">);</span>
</code></pre></div>
<p><code>nprocs</code> now holds the total number of processes, while <code>iam</code> stores the rank of the current process. 
According to the <a href="https://netlib.org/blacs/BLACS/QRef.html#BLACS_PINFO"><code>BLACS_PINFO</code> specification</a>, <code>0 &lt;= iam &lt; nprocs</code>. 
A common practice is to have the rank-0 process handle tasks that should be executed only once, such as reading or writing files. 
In this context, the rank-0 process is often considered the primary process (though not necessarily the first one to start running), while the other processes serve as followers.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Note the use of <code>lapack_int</code>, a type that can be defined to support 32- or 64-bit integers. This is crucial when working with large matrices where addressing large indices is necessary. While you could use <code>int</code>, doing so would reduce portability across systems.</p>
</div>
<p>Now it's time to create a process grid. 
A grid groups processes into a subset that will collaborate on various computational tasks involving matrices distributed across the grid. 
In this example, we'll request a 2x2 grid:</p>
<div class="highlight"><pre><span></span><code><span class="n">lapack_int</span><span class="w"> </span><span class="n">sys_ctx</span><span class="p">,</span><span class="w"> </span><span class="n">grid_ctx</span><span class="p">,</span><span class="w"> </span><span class="n">grid_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">grid_N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">loc_row</span><span class="p">,</span><span class="w"> </span><span class="n">loc_col</span><span class="p">;</span>

<span class="c1">// get the system context</span>
<span class="n">SCALAPACKE_blacs_get</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sys_ctx</span><span class="p">);</span>

<span class="c1">// create a (grid_M x grid_N) grid</span>
<span class="n">grid_ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sys_ctx</span><span class="p">;</span>
<span class="n">SCALAPACKE_blacs_gridinit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">grid_ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;R&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">grid_M</span><span class="p">,</span><span class="w"> </span><span class="n">grid_N</span><span class="p">);</span>

<span class="c1">// request my position in the grid</span>
<span class="n">SCALAPACKE_blacs_gridinfo</span><span class="p">(</span><span class="n">grid_ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">grid_M</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">grid_N</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">loc_row</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">loc_col</span><span class="p">);</span>
</code></pre></div>
<p>Each process grid is identified by a <strong>context</strong>, which is derived from the main (or system) context. 
To create a grid, first request the main context using <a href="https://netlib.org/blacs/BLACS/QRef.html#BLACS_GET"><code>BLACS_GET</code></a> and store it in <code>sys_ctx</code>.</p>
<p>To preserve the value, store it in <code>grid_ctx</code>. </p>
<p>Next, use <a href="https://netlib.org/blacs/BLACS/QRef.html#BLACS_GRIDINIT"><code>BLACS_GRIDINIT</code></a> to initialize the grid, which will automatically map each process to a position within the grid (or outside if it doesn't belong to the grid).
This is illustrated below:</p>
<p><img alt="" src="../../assets/blacs_gridinit.svg" /></p>
<details class="note">
<summary>Arguments of <code>BLACS_GRIDINIT</code></summary>
<ul>
<li><strong>The context</strong> (<code>grid_ctx</code>).
  It serves as both input and output, meaning it accepts the main context and returns the new grid context. </li>
<li>How processes are mapped onto the grid (here <code>"R"</code>, meaning in row-order), though this detail is generally not critical.</li>
<li>The number of <strong>rows</strong> that the grid should contain, and of <strong>columns</strong> (<code>grid_M, grid_N</code>). </li>
</ul>
</details>
<p>You can create as many grids as you want, which is useful if a given task requires a different grid.
You can also use <a href="https://netlib.org/blacs/BLACS/QRef.html#BLACS_GRIDMAP"><code>BLACS_GRIDMAP</code></a> to manually map the processes to the grid, which is useful if you want to create disjoint grids (<em>e.g.</em>, if you want to map a part of the processes on a given grid, and the other part on another).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the number of processes is fewer than the grid size, <code>BLACS_GRIDINIT</code> will abort the program.
In the example above, this means that the program must be run with at least 4 processes.</p>
<p>Extra processes beyond the grid size will remain idle and perform no computational tasks. 
From a user's perspective, this situation should be avoided, as increasing the number of processes without adjusting the grid size will not result in any speedup.
Therefore, it's generally advisable to adapt the grid size to match the number of processes. 
The optimal grid shape and size, however, will depend on the specific problem being solved.</p>
</div>
<p>Finally, use <a href="https://netlib.org/blacs/BLACS/QRef.html#BLACS_GRIDINFO"><code>BLACS_GRIDINFO</code></a> to get the position of the process within the grid. 
If the process is within the grid, <code>0 &lt;= loc_row &lt; grid_M &amp;&amp; 0 &lt;= loc_col &lt; grid_N</code>, otherwise, <code>loc_row == -1 &amp;&amp; loc_col == -1</code>. 
Note that in this function, <code>grid_M</code> and <code>grid_N</code> are output parameters, meaning you can call this function at any time to retrieve the grid size and the process's position within it, as long as you provide its grid context, <code>grid_ctx</code>.</p>
<p>Note that <strong>all</strong> processes should execute <code>BLACS_GRIDINIT</code>, maybe to discover with <code>BLACS_GRIDINFO</code> that they are not part of this grid.</p>
<h3 id="2-distribute-data-on-the-grid">2. Distribute data on the grid<a class="headerlink" href="#2-distribute-data-on-the-grid" title="Permanent link">¤</a></h3>
<p>scaLAPACK expects arrays to be divided into <strong>blocks</strong> that are distributed among the processes in a grid. 
Specifically, it uses a <a href="https://netlib.org/utk/papers/sc96-scalapack/NODE8.HTM">block cyclic distribution algorithm</a>.</p>
<p>For example, consider a 8x8 array with 3x3 blocks:</p>
<p><img alt="Block Cyclic Distribution" src="../../assets/cyclic_distribution.svg" /></p>
<p>As shown, not all processes hold all the data. 
The entire array is referred to as the <strong>global array</strong>, which is scattered across different processes. 
Each process only stores a portion of the global array, known as the <strong>local memory</strong> or submatrix. 
This approach is efficient in terms of memory usage.</p>
<p>While the formulas to determine the shape of the local array and the position of each element within it are straightforward to derive, helper functions are already available. 
To determine the shape of the local matrix, you can use the auxiliary function <a href="https://netlib.org/scalapack/explore-html/d4/d48/numroc_8f_source.html"><code>NUMROC</code></a> function (<code>NUMROC</code> stands for "NUMber of Rows Or Columns"):</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">loc_row</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">loc_cols</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if process is on the grid</span>
<span class="w">    </span><span class="n">lapack_int</span><span class="w"> </span><span class="n">blk_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Starting from a MxN matrix, compute the shape of the local one, loc_Mxloc_N</span>
<span class="w">    </span><span class="n">lapack_int</span><span class="w"> </span><span class="n">loc_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SCALAPACKE_numroc</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">blk_size</span><span class="p">,</span><span class="w"> </span><span class="n">loc_row</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">grid_M</span><span class="p">);</span>
<span class="w">    </span><span class="n">lapack_int</span><span class="w"> </span><span class="n">loc_N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SCALAPACKE_numroc</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">blk_size</span><span class="p">,</span><span class="w"> </span><span class="n">loc_col</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">grid_N</span><span class="p">);</span>
</code></pre></div>
<details class="note">
<summary>Arguments of <code>NUMROC</code></summary>
<p>To determine the local dimensions (number of rows and columns), the <code>NUMROC</code> function requires the following arguments:</p>
<ul>
<li><strong>Global dimension length</strong>: the size of the corresponding dimension of the global array (<code>M</code>/<code>N</code>).</li>
<li><strong>Block size</strong>: the size of each block in the block cyclic distribution (<code>blk_size</code>).</li>
<li><em><em>Process coordinate</em>: the coordinate of the process within the grid for that dimension</em> (<code>loc_row</code>/<code>loc_col</code>).</li>
<li><strong>Process owning index 0</strong>: the coordinate of the process that owns index 0 in that dimension (here, it is <code>0</code>).</li>
<li><strong>Grid dimension size</strong>: the total number of processes in that grid dimension (<code>grid_M</code>/<code>grid_N</code>).</li>
</ul>
</details>
<p>By definition, <code>0 &lt;= loc_M &lt; N &amp;&amp; 0 &lt;= loc_N &lt; N</code>.
With these values, you can then allocate the submatrix locally.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Allocate the local memory</span>
<span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">loc_A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calloc</span><span class="p">(</span><span class="n">loc_M</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">loc_N</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
</code></pre></div>
<p>The last step before filling the array is to create a <strong>descriptor</strong>, which describes how it is scattered across the process grid, using the auxiliary function <a href="https://netlib.org/scalapack/explore-html/dd/d22/descinit_8f_source.html"><code>DESCINIT</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="n">lapack_int</span><span class="w"> </span><span class="n">loc_LD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loc_M</span><span class="p">;</span>
<span class="n">lapack_int</span><span class="w"> </span><span class="n">desc_A</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
<span class="n">SCALAPACKE_descinit</span><span class="p">(</span><span class="n">desc_A</span><span class="p">,</span>
<span class="w">                    </span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">blk_size</span><span class="p">,</span><span class="w"> </span><span class="n">blk_size</span><span class="p">,</span>
<span class="w">                    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">grid_ctx</span><span class="p">,</span>
<span class="w">                    </span><span class="n">loc_LD</span><span class="p">);</span>
</code></pre></div>
<p>To create a descriptor for scaLAPACK, you need to provide 9 arguments that will define the structure of the data distribution across the process grid. 
The descriptor will be used by ScaLAPACK functions to map between local and global arrays.</p>
<details class="note">
<summary>Arguments of <code>DESCINIT</code></summary>
<ol>
<li>
<p><strong>Descriptor array</strong> (<code>lapack_int desc_A[9]</code>, output): an array of 9 integers that will be filled to define the descriptor.</p>
</li>
<li>
<p><strong>Global array dimensions</strong> (<code>M, N</code>): the dimensions of the global array, where <code>M</code> is the number of rows and <code>N</code> is the number of columns.</p>
</li>
<li>
<p><strong>Block size</strong> (<code>blk_size, blk_size</code>): the block size along both dimensions of the array. </p>
</li>
<li>
<p><strong>Process grid coordinates</strong> (<code>0, 0</code>): the coordinates of the first process in the process grid. For most use cases, this will be <code>(0, 0)</code>, indicating the top-left corner of the grid.</p>
</li>
<li>
<p><strong>Grid context</strong> (<code>grid_ctx</code>): the BLACS context that defines the process grid. This context manages the communication between processes.</p>
</li>
<li>
<p><strong>Leading dimension (of local submatrix)</strong> (<code>loc_LD</code>): the leading dimension of the local submatrix, which is typically the number of rows in the local block. 
    This must satisfy <code>loc_LD &gt;= loc_M</code>.</p>
</li>
</ol>
</details>
<p>Once this descriptor is initialized, it can be passed to PBLAS/scaLAPACK functions, enabling them to correctly interpret the mapping between the local data (distributed across the processes) and the global array. 
This ensures that operations performed by scaLAPACK are correctly applied to the global matrix in a distributed computing environment.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have multiple arrays of the same size distributed across the same grid, you don't need a separate descriptor for each one. 
A descriptor simply describes how an array of a specific size is distributed on a particular grid, so one descriptor can be reused for all arrays with the same distribution.</p>
</div>
<p>To fill the local parts of the array, we have two solutions:</p>
<ol>
<li>Filling the array locally, or</li>
<li>Creating the array on one process and communicate.</li>
</ol>
<p>Let's explore the two options.</p>
<h4 id="filling-the-array-locally">Filling the array locally<a class="headerlink" href="#filling-the-array-locally" title="Permanent link">¤</a></h4>
<p>If the array's contents can be determined locally on each process, this is the preferred approach as it eliminates the need for inter-process communication. 
To do this, you must map local indices to global indices, which can be done using the auxiliary function <a href="https://netlib.org/scalapack/explore-html/d4/deb/indxl2g_8f_source.html"><code>INDXL2G</code></a>. This function facilitates the mapping from a local array element <code>loc_A(loc_i, loc_j)</code> to the corresponding global array element <code>A(glob_i, glob_j)</code>.</p>
<details class="note">
<summary>Parameters of <code>INDXL2G</code></summary>
<ul>
<li>
<p><strong>Local Index</strong>: The index of the element within the local block on the process  (<code>loc_i</code>/<code>loc_j</code>).</p>
</li>
<li>
<p><strong>Block Size</strong> (<code>blk_size</code>): The size of the block in the corresponding dimension (rows or columns, <code>blk_size</code>).</p>
</li>
<li>
<p><strong>Local Dimension Length</strong>: The number of rows or columns in the local array for that dimension (<code>loc_row</code>/<code>loc_col</code>).</p>
</li>
<li>
<p><strong>First Process</strong>: The process coordinate (in the grid) where the distribution of blocks begins. 
  Typically, this is set to <code>0</code>.</p>
</li>
<li>
<p><strong>Grid Dimension Length</strong>: The total number of processes along the corresponding dimension (rows or columns) in the process grid (<code>grid_M</code>/<code>grid_N</code>).</p>
</li>
</ul>
</details>
<p>For example, consider making the global array <code>A</code> symmetric, where each element is defined by the formula:</p>
<div class="arithmatex">\[A_{ij} = 1 + \frac{|i-j|}{2}\]</div>
<p>In this case, you would use <code>INDXL2G</code> to determine the global indices <code>glob_i</code> and <code>glob_j</code> corresponding to the local indices <code>loc_i</code> and <code>loc_j</code>, then apply the formula locally to fill the array.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// fill array locally</span>
<span class="k">for</span><span class="p">(</span><span class="n">lapack_int</span><span class="w"> </span><span class="n">loc_j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">loc_j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">loc_N</span><span class="p">;</span><span class="w"> </span><span class="n">loc_j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">lapack_int</span><span class="w"> </span><span class="n">glob_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SCALAPACKE_indxl2g</span><span class="p">(</span><span class="n">loc_j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">blk_size</span><span class="p">,</span><span class="w"> </span><span class="n">loc_col</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">grid_N</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">lapack_int</span><span class="w"> </span><span class="n">loc_i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">loc_i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">loc_M</span><span class="p">;</span><span class="w"> </span><span class="n">loc_i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">        </span><span class="n">lapack_int</span><span class="w"> </span><span class="n">glob_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SCALAPACKE_indxl2g</span><span class="p">(</span><span class="n">loc_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">blk_size</span><span class="p">,</span><span class="w"> </span><span class="n">loc_row</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">grid_M</span><span class="p">)</span><span class="w"> </span><span class="p">;</span>

<span class="w">        </span><span class="c1">// set loc_A[loc_i,loc_j] with the content of A[glob_i, glob_j]</span>
<span class="w">        </span><span class="n">loc_A</span><span class="p">[</span><span class="n">loc_j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">loc_LD</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">loc_i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fabs</span><span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">glob_i</span><span class="w"> </span><span class="o">-</span><span class="w">  </span><span class="n">glob_j</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Notice that:</p>
<ul>
<li>the code store the data in the array using column-major ordering.</li>
<li>When passed to scaLAPACK(e) function, array index starts at one rather than zero.</li>
</ul>
</div>
<h4 id="broadcasting-the-array">Broadcasting the array<a class="headerlink" href="#broadcasting-the-array" title="Permanent link">¤</a></h4>
<p>When it is not feasible to create the array locally on each process—such as when the data is read from a file—an alternative approach is to create the global array on a single process and then distribute the blocks to other processes. 
This can be efficiently accomplished using one of the <a href="https://www.intel.com/content/www/us/en/docs/onemkl/developer-reference-c/2023-0/p-gemr2d.html"><code>P?GEMR2D</code></a> auxiliary functions, such as <code>PDGEMR2D</code> for double-precision arrays.</p>
<p>First, a new grid is needed that includes only the rank-0 process, which will be responsible for creating and initially holding the global matrix. 
This grid is created as follows:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// this grid should be created right after grid_ctx</span>
<span class="c1">// Reminder: all processes should call GRIDINIT, </span>
<span class="c1">// only to discover later that they are not part of it ;)</span>
<span class="n">lapack_int</span><span class="w"> </span><span class="n">ctx_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sys_ctx</span><span class="p">;</span>
<span class="n">SCALAPACKE_blacs_gridinit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx_0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;R&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</code></pre></div>
<p>Here, <code>ctx_0</code> is the new grid context for the rank-0 process, where the global array will be created.</p>
<p>Next, a descriptor for the global matrix is created, and the matrix is allocated and filled by the rank-0 process:</p>
<div class="highlight"><pre><span></span><code><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">glob_A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="n">lapack_int</span><span class="w"> </span><span class="n">desc_glob_A</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>

<span class="k">if</span><span class="p">(</span><span class="n">iam</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// create a proper descriptor for this array</span>
<span class="w">    </span><span class="n">SCALAPACKE_descinit</span><span class="p">(</span><span class="n">desc_glob_A</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">ctx_0</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// fill global array</span>
<span class="w">    </span><span class="n">glob_A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calloc</span><span class="p">(</span><span class="n">M</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">lapack_int</span><span class="w"> </span><span class="n">glob_j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">glob_j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">glob_j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">lapack_int</span><span class="w"> </span><span class="n">glob_i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">glob_i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">glob_i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">glob_A</span><span class="p">[</span><span class="n">glob_j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">glob_i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fabs</span><span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">glob_i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">glob_j</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span>
<span class="w">    </span><span class="n">desc_glob_A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Mark processes that do not allocate the global array</span>
</code></pre></div>
<p>In this setup, only the rank-0 process allocates and fills <code>glob_A</code>. 
All other processes signal that they do not hold a part of the global array by setting the second element of the descriptor (<em>i.e.</em>, <code>desc_glob_A[1]</code>) to -1.</p>
<p>Once the global matrix is ready on rank-0, it can be redistributed to all processes in the main grid (<code>grid_ctx</code>) using <code>PDGEMR2D</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Distribute the global matrix across the process grid</span>
<span class="n">SCALAPACKE_pdgemr2d</span><span class="p">(</span>
<span class="w">  </span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span>
<span class="w">  </span><span class="n">glob_A</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">desc_glob_A</span><span class="p">,</span><span class="w"> </span><span class="c1">// Source: global matrix on rank-0</span>
<span class="w">  </span><span class="n">loc_A</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">desc_A</span><span class="p">,</span><span class="w">       </span><span class="c1">// Destination: local matrices on each process</span>
<span class="w">  </span><span class="n">grid_ctx</span>
<span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iam</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">glob_A</span><span class="p">);</span><span class="w"> </span><span class="c1">// Free the global matrix on rank-0 after redistribution</span>
</code></pre></div>
<details class="note">
<summary>Arguments of <code>PDGEMR2D</code></summary>
<ul>
<li>
<p><strong>Global array shape</strong>: the number of rows and columns in the global array (<code>M, N</code>).</p>
</li>
<li>
<p><strong>Source Matrix</strong>:</p>
<ul>
<li><code>glob_A</code>: Pointer to the memory holding the global matrix.</li>
<li><code>1, 1</code>: Coordinates of the starting element in the source matrix.</li>
<li><code>desc_glob_A</code>: Descriptor for the global matrix.</li>
</ul>
</li>
<li>
<p><strong>Destination Matrix</strong>:</p>
<ul>
<li><code>loc_A</code>: Pointer to the local matrix on each process.</li>
<li><code>1, 1</code>: Coordinates of the starting element in the destination matrix.</li>
<li><code>desc_A</code>: Descriptor for the local matrix.</li>
</ul>
</li>
<li>
<p><strong>Grid context</strong>: the context that includes all processes involved in the source and destination grids (here, <code>grid_ctx</code>).</p>
</li>
</ul>
</details>
<p>Note that there are additional point-to-point and broadcast communication of arrays functions available at the BLACS level. 
For a comprehensive overview, refer to <a href="https://netlib.org/blacs/BLACS/QRef.html">the BLACS quick reference guide</a>.</p>
<p>Furthermore, for an example of point-to-point communication, you can explore <a href="https://github.com/pierre-24/scalapacke/blob/dev/tests/hello_blacs.c">one of our test programs</a>, which demonstrates the use of the <a href="https://netlib.org/blacs/BLACS/QRef.html#SD"><code>?GESD2D</code></a> and <a href="https://netlib.org/blacs/BLACS/QRef.html#RV"><code>?GERV2D</code></a> functions for sending and receiving data between processes. </p>
<h3 id="3-call-the-function">3. Call the function<a class="headerlink" href="#3-call-the-function" title="Permanent link">¤</a></h3>
<p>Now that we have one array distributed on the grid, we can finally perform some calculation.
Of course, you can follow the same steps to distribute other arrays to compute more complex things.</p>
<div class="admonition warning">
<p class="admonition-title">Local versus global arguments</p>
<p>scaLAPACK distinguishes between local and global data.
Indeed, local arguments may have different values on each process in the process grid. 
Global arguments must have the same value on each process.</p>
</div>
<p>To finish our example, let's compute the eigenvalues of <span class="arithmatex">\(A\)</span>, using <a href="https://netlib.org/scalapack/explore-html/d0/d1a/pdsyev_8f_source.html"><code>PDSYEV</code></a> (since <span class="arithmatex">\(A\)</span> is symmetric).
The function requires an auxiliary workspace, <code>WORK</code>, for which the rules are a bit convoluted.
We will therefore make two calls: one to request the ideal size, the second to actually do the calculation:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// request the size of `WORK` by setting `LWORK` to -1</span>
<span class="kt">double</span><span class="w"> </span><span class="n">tmpw</span><span class="p">;</span>
<span class="n">SCALAPACKE_pdsyev</span><span class="p">(</span>
<span class="w">  </span><span class="s">&quot;N&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;U&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="n">loc_A</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">desc_A</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="n">w</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">desc_A</span><span class="p">,</span>
<span class="w">  </span><span class="o">&amp;</span><span class="n">tmpw</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="n">lapack_int</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lapack_int</span><span class="p">)</span><span class="w"> </span><span class="n">tmpw</span><span class="p">;</span>

<span class="c1">// compute the eigenvalues, stored in `w`</span>
<span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calloc</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="p">));</span>
<span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calloc</span><span class="p">(</span><span class="n">lwork</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="p">));</span>
<span class="n">SCALAPACKE_pdsyev</span><span class="p">(</span>
<span class="w">  </span><span class="s">&quot;N&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;U&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="n">loc_A</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">desc_A</span><span class="p">,</span><span class="w"> </span><span class="c1">// input matrix</span>
<span class="w">  </span><span class="n">w</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">desc_A</span><span class="p">,</span><span class="w">  </span><span class="c1">// eigenvectors</span>
<span class="w">  </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="p">);</span>
</code></pre></div>
<h3 id="4-release">4. Release!<a class="headerlink" href="#4-release" title="Permanent link">¤</a></h3>
<p><img alt="" src="https://media1.tenor.com/m/rFwzdbMTeAoAAAAd/card-captor-sakura-anime.gif" /></p>
<p><em>"Release" is the final word in <a href="https://en.wikipedia.org/wiki/Cardcaptor_Sakura">Sakura</a>'s spell to activate her scepter, so she shouts it in every episode. Couldn't resist the reference! 😉</em></p>
<p>More seriously, this is just a reminder that all things that were allocated once should be released, including BLACS internals.
Thus:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">work</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">loc_A</span><span class="p">);</span>

<span class="w">    </span><span class="n">SCALAPACKE_blacs_gridexit</span><span class="p">(</span><span class="n">grid_ctx</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">SCALAPACKE_blacs_exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// ... Ashes to ashes, dust to dust.</span>
</code></pre></div>
<h2 id="compilation-and-execution">Compilation and execution<a class="headerlink" href="#compilation-and-execution" title="Permanent link">¤</a></h2>
<p>You can find the source code for this example in <a href="../../assets/tutorial.tar.gz">this archive</a>. 
A <code>meson.build</code> file, compatible with the <a href="https://github.com/mesonbuild/meson">Meson build system</a>, is also included. 
You may need to adjust the ScaLAPACKe-related options according to <a href="../install/#with-meson-in-your-project-recommended">this documentation</a>.</p>
<p>To build the executable, follow these steps:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Use the MPI compiler</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CC</span><span class="o">=</span>mpicc

<span class="c1"># Fetch the libraries and prepare the build environment</span>
meson<span class="w"> </span>setup<span class="w"> </span>_build

<span class="c1"># Compile the code</span>
meson<span class="w"> </span>compile<span class="w"> </span>-C<span class="w"> </span>_build
</code></pre></div>
<p>After the compilation completes, a <code>tutorial</code> executable will be created in the <code>_build</code> directory.</p>
<p>To run the executable, use <a href="https://docs.open-mpi.org/en/v5.0.x/man-openmpi/man1/mpirun.1.html"><code>mpiexec</code></a>, which is provided by your MPI installation. 
For example, to launch the application with 4 processes, run:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># to launch the application with 4 processes</span>
mpiexec<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>_buid/tutorial
</code></pre></div>
<p>If you monitor your resource manager (e.g., <code>htop</code>) during execution (but you need to be quick!), you will notice that the application is indeed launched four times, corresponding to the four processes.</p>
<p>The program prints the eigenvalues of <span class="arithmatex">\(A\)</span>.
You can check their correctness by running the following Python code:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">.5</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">A</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>
<h2 id="notes-on-performance">Notes on Performance<a class="headerlink" href="#notes-on-performance" title="Permanent link">¤</a></h2>
<p>The <a href="https://netlib.org/scalapack/slug/node106.html">ScaLAPACK documentation</a> offers several performance recommendations:</p>
<blockquote>
<ul>
<li>Local matrix size of approximately 1000-by-1000.</li>
<li>Avoid solving small problems on too many processors.</li>
<li>Use an efficient data distribution with a square processor grid and a square block size (e.g., 64).</li>
</ul>
</blockquote>
<p>However, these guidelines are over 25 years old and may not fully reflect the capabilities of modern hardware and software. 
Below is an updated set of recommendations:</p>
<ul>
<li>
<p><strong>Square Process Grid</strong>: A square process grid (<code>P ≈ Q</code>) generally provides better performance. 
  This configuration helps to balance the computational load and minimize communication overhead.</p>
</li>
<li>
<p><strong>Adapt Distribution to Resources</strong>: It's important to adapt the data distribution to the number of available processes. 
  Uneven distribution can cause load imbalance, where some processes are idle while others continue to compute, reducing overall efficiency.</p>
</li>
<li>
<p><strong>Optimal Block Size</strong>: The block size is crucial for performance, as it impacts both load balancing and communication costs. 
  Typical block sizes range from 32 to 128, but the optimal size may vary depending on the specific problem and hardware.</p>
</li>
<li>
<p><strong>Minimize Communication</strong>: Whenever possible, reduce communication between processes. 
  Keeping data local and minimizing data exchange can significantly enhance performance.</p>
</li>
<li>
<p><strong>Memory Alignment</strong>: Proper memory alignment is critical for maximizing performance on modern processors. 
  Misaligned memory accesses can lead to cache inefficiencies and slower execution times.</p>
</li>
<li>
<p><strong>OpenMP</strong>: for some local computations, you can also take advantage of <a href="https://openmp.llvm.org/">OpenMP</a>.</p>
</li>
</ul>
<p>By following these updated recommendations, you can achieve better performance in ScaLAPACK, taking full advantage of current computing architectures.</p>
<h2 id="conclusions">Conclusions<a class="headerlink" href="#conclusions" title="Permanent link">¤</a></h2>
<p>Thanks to this tutorial, you know understand better how an application using scaLAPACK(e) should be designed.
Now, the sky is the limit to what you can achieve with those tools 😀</p>
<p>Now, don't forget to <a href="../quickstart/">read about the few quirks of scaLAPACKe</a>.</p>
<p><strong>Few other tutorials on scaLAPACK:</strong></p>
<ul>
<li><a href="https://info.gwdg.de/wiki/doku.php?id=wiki:hpc:scalapack">https://info.gwdg.de/wiki/doku.php?id=wiki:hpc:scalapack</a></li>
<li><a href="https://gitlab.phys.ethz.ch/hpcse_fs15/lecture">https://gitlab.phys.ethz.ch/hpcse_fs15/lecture</a></li>
<li><a href="https://andyspiros.wordpress.com/2011/07/08/an-example-of-blacs-with-c/">https://andyspiros.wordpress.com/2011/07/08/an-example-of-blacs-with-c/</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../quickstart/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Quickstart">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Quickstart
              </div>
            </div>
          </a>
        
        
          
          <a href="../../contrib/CONTRIBUTING/" class="md-footer__link md-footer__link--next" aria-label="Next: Contributing">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Contributing
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.footer"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.af256bd8.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
      
        <script src="../../javascript/katex.js"></script>
      
    
  </body>
</html>